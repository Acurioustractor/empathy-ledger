(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[382],{1322:(e,t,s)=>{"use strict";s.d(t,{DQ:()=>l,LK:()=>c,eC:()=>a,vL:()=>o});var i=s(8956),r=s.n(i);function n(){let e="patB6rwNADWNQswxy.9d5acbffc33a62c896d920b77b1c75bab5dd6aabb7e669980ec85135eee70448",t="app7G3Ae65pBblJke";if(!e||!t)throw Error("Airtable API Key or Base ID is missing from environment variables.");return new(r())({apiKey:e}).base(t)}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n()(e),{filterBy:i,filterValue:r,filterByFormula:l,sortBy:a,sortDirection:o="asc",pageSize:c=100,fields:d}=t,h={pageSize:c};l?h.filterByFormula=l:i&&r&&("RECORD_ID()"===i.toUpperCase()?h.filterByFormula="RECORD_ID() = '".concat(r,"'"):h.filterByFormula="{".concat(i,"} = '").concat(r,"'")),a&&(h.sort=[{field:a,direction:o}]),d&&d.length>0&&(h.fields=d);try{let e=(await s.select(h).all()).map(e=>{var t;return{id:e.id,createdTime:null==(t=e._rawJson)?void 0:t.createdTime,...e.fields}});return{records:e,totalCount:e.length}}catch(e){return{records:[],totalCount:0}}}async function a(e,t){let s=n();try{var i;let r=(await s(e).create([{fields:t}]))[0];return{success:!0,data:{id:r.id,createdTime:null==(i=r._rawJson)?void 0:i.createdTime,...r.fields}}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}async function o(e,t,s){let i=n();try{var r;let n=(await i(e).update([{id:t,fields:s}]))[0];return{success:!0,data:{id:n.id,createdTime:null==(r=n._rawJson)?void 0:r.createdTime,...n.fields}}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}async function c(e,t){let s=n();try{return await s(e).destroy([t]),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}},7636:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var i=s(5155),r=s(2115),n=s(5695),l=s(1322);let a={STORYTELLERS:"Storytellers",MEDIA:"Media",THEMES:"Themes",STORIES:"Stories"},o=e=>{let{storytellers:t,activeStorytellerId:s,onSelectStoryteller:r}=e;return t&&0!==t.length?(0,i.jsxs)("div",{className:"flex flex-col space-y-2 p-2 max-h-[60vh] min-h-[200px] min-w-[220px] w-full overflow-y-auto",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-amber-400 uppercase tracking-wider px-2 pt-1",children:"Select Storyteller"}),t.map(e=>(0,i.jsxs)("button",{title:e.name,onClick:()=>r(e.id),className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-amber-400/70\n            ".concat(s===e.id?"bg-amber-500/30 border-2 border-amber-400 shadow text-amber-200":"bg-gray-800/60 border border-transparent hover:bg-gray-700/70 text-gray-200","\n          "),children:[e.avatarUrl?(0,i.jsx)("img",{src:e.avatarUrl,alt:e.name,className:"w-8 h-8 rounded-full object-cover flex-shrink-0 border border-white/20"}):(0,i.jsx)("span",{className:"w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center text-base font-semibold text-white/90 border border-white/20",style:{backgroundColor:e.color},children:e.name.charAt(0)}),(0,i.jsx)("span",{className:"text-sm truncate ".concat(s===e.id?"font-bold":""),children:e.name})]},e.id))]}):(0,i.jsx)("p",{className:"text-xs text-gray-400 p-4 text-center",children:"No storytellers to display."})};var c=s(6540);let d=e=>{let{activeStoryteller:t,allThemes:s}=e,n=(0,r.useRef)(null),[l,a]=(0,r.useState)({width:600,height:400}),[o,d]=(0,r.useState)([]),[h,m]=(0,r.useState)([]),[u,x]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=()=>{if(n.current){let e=n.current.getBoundingClientRect();a({width:e.width,height:e.height})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>{if(!t){d([]),m([]);return}let e=(t.themes||[]).map(e=>"string"==typeof e?e:e.id),i=s.filter(t=>e.includes(t.id)),r=i.map(e=>({id:e.id,label:e.name,type:"theme",color:e.color||"#38bdf8"})),n={id:t.id,label:t.name,type:"storyteller",color:t.color||"#fbbf24",fx:l.width/2,fy:l.height/2},a=i.map(e=>({source:t.id,target:e.id}));d([n,...r]),m(a)},[s,t,l]),(0,r.useEffect)(()=>{if(0===o.length)return;let e=c.tXi(o).force("charge",c.xJS().strength(-120)).force("center",c.jTM(l.width/2,l.height/2)).force("collision",c.eRw().radius(40)).force("link",c.kJC(h).id(e=>e.id).distance(120)).stop();for(let t=0;t<120;++t)e.tick();d([...e.nodes()])},[o.length,h,l,o]);let[f,g]=(0,r.useState)("0 0 600 400");return(0,r.useEffect)(()=>{g("0 0 ".concat(l.width," ").concat(l.height))},[l]),(0,i.jsx)("div",{ref:n,className:"w-full h-full min-h-[240px] max-h-[60vh] aspect-[3/2]",children:(0,i.jsxs)("svg",{width:"100%",height:"100%",viewBox:f,className:"w-full h-full bg-black/80 rounded-lg",style:{touchAction:"none"},children:[h.map((e,t)=>{var s,r,n,l;let a=o.find(t=>t.id===e.source),c=o.find(t=>t.id===e.target);return a&&c?(0,i.jsx)("line",{x1:null!=(s=a.fx)?s:a.x,y1:null!=(r=a.fy)?r:a.y,x2:null!=(n=c.fx)?n:c.x,y2:null!=(l=c.fy)?l:c.y,stroke:"#38bdf8",strokeWidth:u&&(u===a.id||u===c.id)?3:1.5,opacity:u&&u!==a.id&&u!==c.id?.2:.7},t):null}),o.map(e=>{var t,s,r,n,l;return(0,i.jsxs)("g",{tabIndex:0,"aria-label":e.label,onMouseEnter:()=>x(e.id),onMouseLeave:()=>x(null),onFocus:()=>x(e.id),onBlur:()=>x(null),style:{cursor:"pointer",outline:"none"},children:[(0,i.jsx)("circle",{cx:null!=(t=e.fx)?t:e.x,cy:null!=(s=e.fy)?s:e.y,r:"storyteller"===e.type?32:22,fill:e.color,stroke:u===e.id?"#fff":"#222",strokeWidth:u===e.id?4:2,opacity:u&&u!==e.id?.4:1}),(0,i.jsx)("text",{x:null!=(r=e.fx)?r:e.x,y:(null!=(l=null!=(n=e.fy)?n:e.y)?l:0)+("storyteller"===e.type?48:34),textAnchor:"middle",fontSize:"storyteller"===e.type?18:14,fill:"#fff",style:{pointerEvents:"none",userSelect:"none"},children:e.label})]},e.id)})]})})};var h=s(3020),m=s(6539),u=s(6766);let x=e=>{let{activeStoryteller:t,onClose:s}=e;return(0,i.jsx)(h.N,{children:t&&(0,i.jsx)(m.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 flex items-center justify-center z-50 bg-black/70 backdrop-blur",children:(0,i.jsxs)("div",{className:"relative w-full max-w-lg bg-gray-900/95 rounded-2xl shadow-2xl border border-gray-700 p-6 flex flex-col max-h-[90vh] overflow-y-auto",children:[(0,i.jsx)("button",{className:"absolute top-3 right-3 p-2 rounded-full bg-gray-700 hover:bg-gray-600 text-gray-200 focus:outline-none focus:ring-2 focus:ring-amber-400/70 z-40","aria-label":"Close panel",onClick:s,children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,i.jsxs)("div",{className:"flex items-start space-x-4 mb-4",children:[t.avatarUrl?(0,i.jsx)(u.default,{src:t.avatarUrl,alt:t.name,width:64,height:64,className:"w-16 h-16 rounded-lg object-cover border-2 border-gray-700"}):(0,i.jsx)("div",{className:"w-16 h-16 rounded-lg flex items-center justify-center text-2xl font-bold text-white/90 border-2 border-gray-700",style:{backgroundColor:t.color},children:t.name.charAt(0)}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-2xl font-bold transition-colors duration-300",style:{color:t.color||"#fbbf24"},children:t.name}),(0,i.jsx)("p",{className:"text-sm text-gray-400 mt-1 line-clamp-2",children:t.description||"No biography available."})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 text-center mb-4",children:[(0,i.jsxs)("div",{className:"bg-white/5 p-3 rounded-md",children:[(0,i.jsx)("div",{className:"text-xl font-bold text-emerald-400",children:t.mediaCount||0}),(0,i.jsx)("div",{className:"text-xs text-gray-400",children:"Media Items"})]}),(0,i.jsxs)("div",{className:"bg-white/5 p-3 rounded-md",children:[(0,i.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:t.themeCount||0}),(0,i.jsx)("div",{className:"text-xs text-gray-400",children:"Unique Themes"})]}),(0,i.jsxs)("div",{className:"bg-white/5 p-3 rounded-md",children:[(0,i.jsx)("div",{className:"text-xl font-bold text-purple-400",children:t.quoteCount||0}),(0,i.jsx)("div",{className:"text-xs text-gray-400",children:"Quotes Shared"})]}),(0,i.jsxs)("div",{className:"bg-white/5 p-3 rounded-md",children:[(0,i.jsx)("div",{className:"text-xl font-bold text-amber-400",children:t.storyCount||0}),(0,i.jsx)("div",{className:"text-xs text-gray-400",children:"Stories Contributed"})]})]}),t.themes&&t.themes.length>0&&(0,i.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-700",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-gray-400 uppercase mb-2",children:"Key Themes"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:t.themes.slice(0,7).map(e=>(0,i.jsx)("span",{className:"text-xs px-2 py-1 rounded-full border",style:{backgroundColor:"".concat(e.color,"33"),borderColor:e.color,color:e.color},children:e.name},e.id))})]})]})})})},f=e=>{let{insights:t}=e;return t&&0!==t.length?(0,i.jsxs)("div",{className:"my-16 mx-4 md:mx-auto max-w-6xl bg-gradient-to-br from-purple-900/20 to-emerald-900/20 backdrop-blur-sm rounded-2xl p-8 border border-gray-700",children:[(0,i.jsx)("h2",{className:"text-2xl md:text-3xl font-bold text-center mb-8 text-purple-400",children:"Emergent Knowledge Patterns"}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.slice(0,4).map((e,t)=>(0,i.jsxs)("div",{className:"bg-gray-800/60 rounded-lg p-6 border-l-4 border-emerald-500 shadow-md transition-all duration-300 hover:bg-gray-700/60 hover:shadow-lg",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-3 text-amber-400",children:e.title}),(0,i.jsx)("p",{className:"text-sm text-gray-300 leading-relaxed",children:e.description})]},t))})]}):(0,i.jsx)("div",{className:"my-16 p-8 bg-gray-800/30 rounded-lg text-center text-gray-400",children:"Generating emergent knowledge patterns..."})},g=()=>{let e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let t=e.current;if(!t)return;let s=[];for(let e=0;e<50;e++){let e=document.createElement("div");e.className="particle absolute w-0.5 h-0.5 bg-white/60 rounded-full",e.style.left="".concat(100*Math.random(),"%"),e.style.top="".concat(100*Math.random(),"%"),e.style.animation="float ".concat(20+20*Math.random(),"s linear infinite"),e.style.animationDelay="".concat(-40*Math.random(),"s"),t.appendChild(e),s.push(e)}return()=>{s.forEach(e=>e.remove())}},[]),(0,i.jsx)("div",{ref:e,className:"fixed inset-0 pointer-events-none z-0 overflow-hidden"})},y=e=>{let{allStorytellers:t}=e;return t&&0!==t.length?(0,i.jsxs)("div",{className:"my-16 mx-4 md:mx-auto max-w-6xl bg-gray-900/30 backdrop-blur-sm rounded-2xl p-8 border border-gray-700",children:[(0,i.jsx)("h2",{className:"text-2xl md:text-3xl font-bold text-center mb-8 text-sky-400",children:"Complete Storyteller Directory"}),(0,i.jsx)("div",{className:"columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-x-6 gap-y-4",children:t.map(e=>(0,i.jsxs)("div",{className:"flex items-center bg-gray-800/50 rounded-md p-3 mb-3 break-inside-avoid-column shadow hover:bg-gray-700/50 transition-colors duration-200",children:[e.avatarUrl?(0,i.jsx)(u.default,{src:e.avatarUrl,alt:e.name,width:32,height:32,className:"w-8 h-8 rounded-full mr-3 flex-shrink-0 border border-white/20 object-cover",unoptimized:!0}):(0,i.jsx)("span",{className:"w-8 h-8 rounded-full mr-3 flex-shrink-0 border border-white/30 flex items-center justify-center text-sm font-semibold text-white/80",style:{backgroundColor:e.color},title:"Color: ".concat(e.color),children:e.name.charAt(0)}),(0,i.jsxs)("div",{className:"flex-grow",children:[(0,i.jsx)("span",{className:"text-sm text-gray-200 font-medium block",children:e.name}),(0,i.jsxs)("div",{className:"text-xs text-gray-400 flex flex-wrap gap-x-2",children:[(0,i.jsxs)("span",{children:[e.mediaCount||0," media"]}),(0,i.jsxs)("span",{children:[e.themeCount||0," themes"]})]})]})]},e.id))})]}):null};function p(e){let{storyteller:t,stories:s,themes:r}=e;if(!t)return null;let{edges:n}=function(e,t){let s=Object.fromEntries(t.map(e=>[e.id,e])),i={};return e.forEach(e=>{let t=e.Themes||[];for(let e=0;e<t.length;e++)for(let s=e+1;s<t.length;s++){let[r,n]=[t[e],t[s]].sort(),l="".concat(r,"|").concat(n);i[l]=(i[l]||0)+1}}),{nodes:Object.values(s),edges:Object.entries(i).map(e=>{let[t,s]=e,[i,r]=t.split("|");return{source:i,target:r,count:s}})}}(s.filter(e=>(Array.isArray(e.Storytellers)?e.Storytellers:"string"==typeof e.Storytellers&&e.Storytellers?[e.Storytellers]:[]).includes(t.id)),r),l=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i={};return e.forEach(e=>{let{source:t,target:s,count:r}=e;i[t]=(i[t]||0)+r,i[s]=(i[s]||0)+r}),Object.entries(i).sort((e,t)=>t[1]-e[1]).slice(0,s).map(e=>{let[s,i]=e;return{...t[s]||{id:s,name:"Unknown",color:"#888"},count:i}})}(n,Object.fromEntries(r.map(e=>[e.id,e])),3);return(0,i.jsxs)("div",{className:"bg-gray-900/80 rounded-lg p-4 shadow-md mt-4",children:[(0,i.jsxs)("h4",{className:"text-base font-semibold mb-2 text-amber-300",children:[t.name,"'s Top Theme Connections"]}),(0,i.jsxs)("ul",{className:"space-y-1",children:[0===l.length&&(0,i.jsx)("li",{className:"text-gray-400 text-sm",children:"No theme connections found."}),l.filter(e=>"string"==typeof e.id).map(e=>(0,i.jsxs)("li",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"inline-block w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,i.jsx)("span",{className:"text-sm text-gray-200",children:e.name}),(0,i.jsxs)("span",{className:"ml-auto text-xs text-gray-400",children:[e.count," connections"]})]},e.id))]})]})}let v=["#10b981","#3b82f6","#fbbf24","#8b5cf6","#ec4899","#f97316","#14b8a6","#6366f1","#d946ef","#f59e0b"],b=[...v].reverse(),w=e=>e.map((e,t)=>({id:e.id,name:e.Name||"Unnamed Storyteller",description:Array.isArray(e["Summary (from Media)"])?e["Summary (from Media)"].join("\n"):e["Summary (from Media)"]||void 0,color:v[t%v.length],avatarUrl:Array.isArray(e["File Profile Image"])&&e["File Profile Image"][0]&&"object"==typeof e["File Profile Image"][0]&&"url"in e["File Profile Image"][0]?e["File Profile Image"][0].url:void 0,themes:[],quotes:[],themeCount:0,quoteCount:0,mediaCount:(e.Media||[]).length,storyCount:0,rawMediaIds:e.Media||[]})),j=e=>e.map((e,t)=>({id:e.id,name:e["Theme Name"]||"Unnamed Theme",description:e.Description||void 0,color:b[t%b.length],stories:0})),N=()=>{let[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)([]),[c,u]=(0,r.useState)(null),[v,b]=(0,r.useState)([]),[N,S]=(0,r.useState)([]),[E,C]=(0,r.useState)(!0),[M,k]=(0,r.useState)(null),[P,T]=(0,r.useState)(null),[A,F]=(0,r.useState)(!1),[I,L]=(0,r.useState)([]),R=(0,r.useCallback)(async()=>{0===e.length&&C(!0),k(null);try{let{records:e}=await (0,l.DQ)(a.STORYTELLERS,{fields:["Name","Summary (from Media)","Media","File Profile Image"]}),s=w(e),{records:i}=await (0,l.DQ)(a.MEDIA,{fields:["Themes","Quotes","Stories","Storytellers"]}),r=new Map(i.map(e=>[e.id,e])),{records:o}=await (0,l.DQ)(a.THEMES,{fields:["Theme Name","Description"]}),d=j(o),h=new Map(d.map(e=>[e.id,e]));b(d);let m=(s=s.map(e=>{let t=(e.rawMediaIds||[]).map(e=>r.get(e)).filter(Boolean),s=Array.from(new Set(t.flatMap(e=>e.Themes||[]))),i=Array.from(new Set(t.flatMap(e=>e.Quotes||[]))),n=Array.from(new Set(t.flatMap(e=>e.Stories||[])));return{...e,themes:s.filter(e=>"string"==typeof e).map(e=>h.get(e)).filter(Boolean),quotes:i.filter(e=>"string"==typeof e).map(e=>({id:e,name:"Quote ".concat(e.slice(-4)),color:"#A0AEC0"})),themeCount:s.length,quoteCount:i.length,mediaCount:t.length,storyCount:n.length}}).sort((e,t)=>{var s,i;return(null!=(s=t.mediaCount)?s:0)-(null!=(i=e.mediaCount)?i:0)})).slice(0,10);t(s),n(m);let x=c?s.find(e=>e.id===c.id):null;!x&&m.length>0&&(x=m[0]),u(x||null),S([{title:"Storyteller Insight 1",description:"Dominant themes for active storytellers...",relatedThemes:[]}]);let{records:f}=await (0,l.DQ)(a.STORIES,{fields:["Title","Themes","Storytellers"]});L(f)}catch(e){k(e instanceof Error?e.message:"An unknown error occurred")}finally{C(!1)}},[]);return((0,r.useEffect)(()=>{R()},[R]),(0,r.useEffect)(()=>{if(!A)return;let e=e=>{"Escape"===e.key&&F(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A]),E&&0===e.length)?(0,i.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-950 text-white",children:(0,i.jsx)("div",{className:"animate-pulse text-xl",children:"Loading Storyteller Constellations..."})}):M?(0,i.jsxs)("div",{className:"flex flex-col justify-center items-center min-h-screen bg-red-900/20 text-white p-4",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"Error Loading Data"}),(0,i.jsx)("p",{className:"text-red-300 mb-6 text-center",children:M}),(0,i.jsx)("button",{onClick:R,className:"px-6 py-2 bg-red-500 hover:bg-red-600 rounded-md text-white font-semibold transition-colors",children:"Try Again"})]}):(0,i.jsxs)("div",{className:"relative min-h-screen bg-gray-950 text-white flex flex-col overflow-auto",children:[(0,i.jsx)(g,{}),(0,i.jsxs)("header",{className:"relative z-10 text-center py-4 md:py-6 px-4 flex-shrink-0",children:[(0,i.jsx)("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-3",children:(0,i.jsx)("span",{className:"bg-gradient-to-r from-amber-400 via-purple-500 to-emerald-500 bg-clip-text text-transparent animate-pulseGlow",children:"Storyteller Constellation"})}),(0,i.jsx)("p",{className:"text-sm md:text-base text-gray-300 max-w-2xl mx-auto",children:"Explore the narratives and thematic footprints of each storyteller."})]}),(0,i.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8 box-border",children:(0,i.jsxs)("div",{className:"relative z-10 w-full max-w-full grid grid-cols-1 lg:grid-cols-[minmax(0,320px)_minmax(0,1fr)] gap-8 items-start",children:[(0,i.jsx)("aside",{className:"w-full max-w-xs lg:max-w-[320px] flex flex-col gap-0 mb-8 lg:mb-0 transition-all duration-300","aria-label":"Storyteller navigation panel",children:(0,i.jsxs)("div",{className:"bg-gray-800/80 rounded-lg shadow border border-gray-700 p-2 flex flex-col",children:[c&&(0,i.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 mb-2 rounded-full bg-amber-500/90 hover:bg-amber-600 text-white font-semibold shadow focus:outline-none focus:ring-2 focus:ring-amber-400/70 transition text-base self-center","aria-label":"Show storyteller info",onClick:()=>T("info"),children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z"})}),"Info"]}),(0,i.jsx)(o,{storytellers:s,activeStorytellerId:(null==c?void 0:c.id)||null,onSelectStoryteller:t=>{u(e.find(e=>e.id===t)||null)}})]})}),(0,i.jsxs)("main",{className:"flex flex-col gap-8 w-full max-w-full justify-center","aria-label":"Storyteller explorer main content",children:[(0,i.jsx)(h.N,{children:"info"===P&&c&&(0,i.jsx)(x,{activeStoryteller:c,onClose:()=>T(null)})}),(0,i.jsxs)("section",{className:"w-full max-w-full border-4 border-orange-500 rounded-lg bg-teal-700/50 p-2 md:p-4 shadow-lg relative flex flex-col items-center justify-center transition-all duration-300 max-h-[70vh]","aria-label":"Constellation visualization",children:[(0,i.jsx)("button",{className:"absolute top-3 right-3 z-20 p-2 rounded-full bg-gray-800/80 hover:bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/70 transition","aria-label":"Enter full screen",onClick:()=>F(!0),children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V6a2 2 0 012-2h2m8 0h2a2 2 0 012 2v2m0 8v2a2 2 0 01-2 2h-2m-8 0H6a2 2 0 01-2-2v-2"})})}),(0,i.jsx)("div",{className:"w-full h-full flex-grow flex items-center justify-center min-h-[240px] max-h-[60vh]",children:(0,i.jsx)(d,{activeStoryteller:c,allThemes:v})})]}),(0,i.jsx)(h.N,{children:A&&(0,i.jsxs)(m.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25},className:"fixed inset-0 z-50 bg-black/95 flex flex-col items-center justify-center","aria-modal":"true",role:"dialog",children:[(0,i.jsx)("button",{className:"absolute top-6 right-6 z-50 p-3 rounded-full bg-gray-800/90 hover:bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-emerald-400/70 transition","aria-label":"Exit full screen",onClick:()=>F(!1),children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",style:{maxWidth:"100vw",maxHeight:"100vh"},children:(0,i.jsx)(d,{activeStoryteller:c,allThemes:v})})]},"fullscreen-constellation")}),(0,i.jsxs)("section",{className:"w-full mt-8","aria-label":"Knowledge insights and full storyteller list",children:[(0,i.jsx)(f,{insights:N}),c&&(0,i.jsx)(p,{storyteller:c,stories:I,themes:v}),(0,i.jsx)(y,{allStorytellers:e})]})]})]})})]})};class S{update(e,t){this.pulsing.factor+=.01*this.pulsing.direction,(this.pulsing.factor>=1||this.pulsing.factor<=0)&&(this.pulsing.direction*=-1),this.x+=this.velocity.x,this.y+=this.velocity.y,(this.x+this.radius>e||this.x-this.radius<0)&&(this.velocity.x*=-1),(this.y+this.radius>t||this.y-this.radius<0)&&(this.velocity.y*=-1)}draw(e,t){let s=this.originalRadius+ +this.pulsing.factor,i=e.createRadialGradient(this.x,this.y,.5*s,this.x,this.y,4*s*t);i.addColorStop(0,this.color),i.addColorStop(1,"transparent"),e.beginPath(),e.arc(this.x,this.y,4*s*t,0,2*Math.PI),e.fillStyle=i,e.fill(),e.beginPath(),e.arc(this.x,this.y,s,0,2*Math.PI),e.fillStyle=this.color,e.fill()}constructor(e,t,s,i){this.x=e,this.y=t,this.radius=s,this.originalRadius=s,this.color=i.color,this.fragment=i.fragment,this.id=i.id,this.title=i.title,this.storytellerName=i.storytellerName,this.velocity={x:(Math.random()-.5)*.2,y:(Math.random()-.5)*.2},this.pulsing={direction:1,factor:Math.random()}}}class E{resizeCanvas(){this.canvas&&this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight)}bindEvents(){this.canvas&&(window.addEventListener("resize",this.resizeCanvas),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseleave",this.handleMouseLeave),this.canvas.addEventListener("click",this.handleCanvasClick))}handleMouseMove(e){if(!this.canvas)return;let t=this.canvas.getBoundingClientRect();this.mousePosition={x:e.clientX-t.left,y:e.clientY-t.top},this.updateActiveStory()}handleMouseLeave(){this.mousePosition={x:null,y:null},this.activeStory=null,this.storyFragmentElement&&(this.storyFragmentElement.style.opacity="0")}handleCanvasClick(e){if(!this.canvas)return;let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,r=null,n=this.config.clickRadius;this.storyPoints.forEach(e=>{let t=this.calculateDistance(e.x,e.y,s,i);t<n&&(r=e,n=t)}),r&&this.router.push("/stories/".concat(r.id))}updateActiveStory(){let e=null,t=this.config.connectionThreshold;if(null!==this.mousePosition.x&&null!==this.mousePosition.y&&this.canvas){let{x:s,y:i}=this.mousePosition;this.storyPoints.forEach(r=>{let n=this.calculateDistance(r.x,r.y,s,i);n<t&&(e=r,t=n)})}if(this.activeStory=e,this.storyFragmentElement){let e=this.activeStory;if(e){let t=e.title||"N/A",s=e.storytellerName?'<p class="text-xs text-gray-300 mb-2">By '.concat(e.storytellerName,"</p>"):"",i=e.fragment||"...";if(this.storyFragmentElement){this.storyFragmentElement.innerHTML='\n            <div class="p-3">\n              <h4 class="font-bold text-sm mb-1 text-indigo-200">'.concat(t,"</h4>\n              ").concat(s,'\n              <p class="text-xs italic text-gray-400 line-clamp-3">').concat(i,"</p>\n            </div>\n          "),this.storyFragmentElement.style.opacity="1";let r=e.y-this.storyFragmentElement.offsetHeight-10,n=e.x-this.storyFragmentElement.offsetWidth/2;r<10&&(r=e.y+20),n<10&&(n=10),this.canvas&&n+this.storyFragmentElement.offsetWidth>this.canvas.width-10&&(n=this.canvas.width-this.storyFragmentElement.offsetWidth-10),this.storyFragmentElement.style.left="".concat(n,"px"),this.storyFragmentElement.style.top="".concat(r,"px")}}else this.storyFragmentElement&&(this.storyFragmentElement.style.opacity="0")}}animate(){this.ctx&&this.canvas&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.updateConnections(),this.renderConnections(),this.renderEmergentPatterns(),this.storyPoints.forEach(e=>{e.update(this.canvas.width,this.canvas.height),e.draw(this.ctx,this.config.glowIntensity)}),this.evolveSystem(),this.animationFrameId=requestAnimationFrame(this.animate))}updateConnections(){this.connections=[];for(let e=0;e<this.storyPoints.length;e++)for(let t=e+1;t<this.storyPoints.length;t++){let s=this.storyPoints[e],i=this.storyPoints[t],r=this.calculateDistance(s.x,s.y,i.x,i.y);if(r<this.config.connectionThreshold){let e=1-r/this.config.connectionThreshold;this.connections.push({pointA:s,pointB:i,strength:e})}}this.mousePosition.x&&this.mousePosition.y&&this.storyPoints.forEach(e=>{let t=this.calculateDistance(e.x,e.y,this.mousePosition.x,this.mousePosition.y);t<this.config.connectionThreshold&&this.connections.forEach(s=>{if(s.pointA===e||s.pointB===e){let e=1-t/this.config.connectionThreshold;s.strength+=e*this.config.interactionInfluence,s.strength=Math.min(s.strength,1)}})})}renderConnections(){this.ctx&&this.connections.forEach(e=>{let t=this.ctx.createLinearGradient(e.pointA.x,e.pointA.y,e.pointB.x,e.pointB.y);t.addColorStop(0,e.pointA.color),t.addColorStop(1,e.pointB.color),this.ctx.beginPath(),this.ctx.moveTo(e.pointA.x,e.pointA.y),this.ctx.lineTo(e.pointB.x,e.pointB.y),this.ctx.strokeStyle="rgba(255, 255, 255, ".concat(.5*e.strength,")"),this.ctx.lineWidth=1,this.ctx.stroke()})}renderEmergentPatterns(){this.ctx&&this.connections.forEach(e=>{if(e.strength>this.config.transformationThreshold){let t=(e.pointA.x+e.pointB.x)/2,s=(e.pointA.y+e.pointB.y)/2,i=this.config.emergentPatternSize*e.strength;this.ctx.beginPath(),this.ctx.arc(t,s,i,0,2*Math.PI);let r=this.blendColors(e.pointA.color,e.pointB.color,.5);this.ctx.fillStyle=r,this.ctx.fill();let n=this.ctx.createRadialGradient(t,s,0,t,s,3*i);n.addColorStop(0,r.replace("0.8","0.4")),n.addColorStop(1,"transparent"),this.ctx.beginPath(),this.ctx.arc(t,s,3*i,0,2*Math.PI),this.ctx.fillStyle=n,this.ctx.fill()}})}evolveSystem(){this.systemAge+=this.config.evolutionSpeed,this.storyPoints.forEach((e,t)=>{let s=.5*Math.sin(this.systemAge+.1*t)+.5;e.velocity.x*=.98+.04*s,e.velocity.y*=.98+.04*s;let i=Math.sqrt(e.velocity.x**2+e.velocity.y**2);i>1&&(e.velocity.x*=1/i,e.velocity.y*=1/i),.005>Math.random()&&(e.velocity.x+=(Math.random()-.5)*.2,e.velocity.y+=(Math.random()-.5)*.2)})}calculateDistance(e,t,s,i){return Math.sqrt(Math.pow(s-e,2)+Math.pow(i-t,2))}blendColors(e,t,s){let i=e=>{let t=e.replace("#","");return 3===t.length?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16)}:6===t.length?{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}:{r:255,g:255,b:255}},r=i(e),n=i(t),l=Math.round(r.r*(1-s)+n.r*s),a=Math.round(r.g*(1-s)+n.g*s),o=Math.round(r.b*(1-s)+n.b*s);return"rgba(".concat(l,", ").concat(a,", ").concat(o,", 0.8)")}start(){!this.animationFrameId&&this.canvas&&this.animate()}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.canvas&&(window.removeEventListener("resize",this.resizeCanvas),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("click",this.handleCanvasClick))}initializeWithData(e){if(!this.canvas)return;this.storyPoints=[];let t=Math.min(e.length,this.config.particleCount);for(let s=0;s<t;s++){let t=e[s],i=Math.random()*(this.canvas.width-2*this.config.particleMaxRadius)+this.config.particleMaxRadius,r=Math.random()*(this.canvas.height-2*this.config.particleMaxRadius)+this.config.particleMaxRadius,n=this.config.particleMinRadius+Math.random()*(this.config.particleMaxRadius-this.config.particleMinRadius);this.storyPoints.push(new S(i,r,n,t))}this.start()}constructor(e,t,s={}){this.canvas=null,this.ctx=null,this.storyPoints=[],this.connections=[],this.mousePosition={x:null,y:null},this.activeStory=null,this.systemAge=0,this.animationFrameId=null,this.storyFragmentElement=null;let i=document.getElementById(e);if(!(i instanceof HTMLCanvasElement))return;this.canvas=i,this.ctx=this.canvas.getContext("2d"),this.storyFragmentElement=document.getElementById("storyFragment"),this.router=t,this.config={particleCount:100,connectionThreshold:150,transformationThreshold:.6,evolutionSpeed:.005,interactionInfluence:.5,particleMinRadius:2,particleMaxRadius:5,glowIntensity:.8,emergentPatternSize:4,clickRadius:20,...s},this.resizeCanvas=this.resizeCanvas.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleCanvasClick=this.handleCanvasClick.bind(this),this.animate=this.animate.bind(this),this.bindEvents(),this.resizeCanvas()}}let C=["#FF5E5B","#D8D8F6","#59C3C3","#EBEBEB","#FFA857","#BCECE0","#EF798A","#F7A399","#7D82B8"];function M(){let e=(0,r.useRef)(null),t=(0,r.useRef)(null),s=(0,n.useRouter)(),[o,c]=(0,r.useState)(!0),[d,h]=(0,r.useState)("storyPoints");return(0,r.useEffect)(()=>{let i=!0;if("storyPoints"===d)if(e.current&&!t.current){let e=new E("constellationCanvas",s,{});e.canvas?(t.current=e,c(!0),(0,l.DQ)(a.STORIES,{pageSize:100,fields:["Title","Story copy","Storytellers"]}).then(async e=>{let{records:s}=e;if(!i)return;let r=Array.from(new Set(s.flatMap(e=>e.Storytellers||[]).filter(e=>!!e))),n=new Map;if(r.length>0){let e="OR(".concat(r.map(e=>"RECORD_ID()='".concat(e,"'")).join(","),")"),{records:t}=await (0,l.DQ)(a.STORYTELLERS,{filterByFormula:e,fields:["Name"]});n=new Map(t.map(e=>[e.id,e.Name]))}let o=s.map((e,t)=>{var s;return{id:e.id,title:e.Title||"Untitled Story",fragment:(null==(s=e["Story copy"])?void 0:s.substring(0,100))+"...",color:C[t%C.length],storytellerName:n.get((e.Storytellers||[])[0])||"Unknown"}});t.current&&t.current.canvas&&t.current.canvas.isConnected&&t.current.initializeWithData(o)}).catch(e=>{i&&c(!1)}).finally(()=>{i&&c(!1)})):i&&c(!1)}else!e.current&&i&&c(!1);else t.current&&(t.current.stop(),t.current=null),c(!1);return()=>{i=!1,t.current&&(t.current.stop(),t.current=null)}},[d,s]),(0,i.jsxs)("div",{className:"relative w-[100vw] h-screen -ml-[calc(50vw-50%)] flex flex-col bg-gray-950 text-white overflow-hidden",children:[(0,i.jsxs)("div",{className:"fixed top-4 right-4 z-[60] flex space-x-2 bg-gray-800/70 p-1 rounded-lg backdrop-blur-sm",children:[(0,i.jsx)("button",{onClick:()=>h("storyPoints"),className:"px-3 py-1.5 text-xs rounded-md transition-colors\n            ".concat("storyPoints"===d?"bg-indigo-600 text-white":"bg-transparent hover:bg-indigo-500/30 text-gray-300","\n          "),children:"Story Constellation"}),(0,i.jsx)("button",{onClick:()=>h("thematic"),className:"px-3 py-1.5 text-xs rounded-md transition-colors\n            ".concat("thematic"===d?"bg-purple-600 text-white":"bg-transparent hover:bg-purple-500/30 text-gray-300","\n          "),children:"Storyteller Explorer"})]}),o&&"storyPoints"===d&&(0,i.jsx)("div",{className:"absolute inset-0 flex justify-center items-center bg-gray-950/80 z-[100]",children:(0,i.jsx)("div",{className:"animate-pulse text-xl",children:"Loading Story Constellation..."})}),"storyPoints"===d&&(0,i.jsxs)("div",{id:"constellationContainer",className:"w-full h-full flex-grow relative",children:[(0,i.jsx)("canvas",{id:"constellationCanvas",ref:e,className:"w-full h-full"}),(0,i.jsx)("div",{id:"storyFragment",className:"absolute bg-black bg-opacity-70 text-white p-2 rounded-md text-xs shadow-lg pointer-events-none transition-opacity duration-300 opacity-0 max-w-xs z-50",style:{backdropFilter:"blur(4px)"}})]}),"thematic"===d&&(0,i.jsx)(N,{})]})}},8900:(e,t,s)=>{Promise.resolve().then(s.bind(s,7636))}},e=>{var t=t=>e(e.s=t);e.O(0,[63,846,753,111,441,684,358],()=>t(8900)),_N_E=e.O()}]);