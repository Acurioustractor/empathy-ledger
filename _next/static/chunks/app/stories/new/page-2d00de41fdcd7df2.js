(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{1322:(e,t,r)=>{"use strict";r.d(t,{DQ:()=>i,LK:()=>d,eC:()=>o,vL:()=>n});var s=r(8956),l=r.n(s);function a(){let e="patB6rwNADWNQswxy.9d5acbffc33a62c896d920b77b1c75bab5dd6aabb7e669980ec85135eee70448",t="app7G3Ae65pBblJke";if(!e||!t)throw Error("Airtable API Key or Base ID is missing from environment variables.");return new(l())({apiKey:e}).base(t)}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a()(e),{filterBy:s,filterValue:l,filterByFormula:i,sortBy:o,sortDirection:n="asc",pageSize:d=100,fields:c}=t,u={pageSize:d};i?u.filterByFormula=i:s&&l&&("RECORD_ID()"===s.toUpperCase()?u.filterByFormula="RECORD_ID() = '".concat(l,"'"):u.filterByFormula="{".concat(s,"} = '").concat(l,"'")),o&&(u.sort=[{field:o,direction:n}]),c&&c.length>0&&(u.fields=c);try{let e=(await r.select(u).all()).map(e=>{var t;return{id:e.id,createdTime:null==(t=e._rawJson)?void 0:t.createdTime,...e.fields}});return{records:e,totalCount:e.length}}catch(e){return{records:[],totalCount:0}}}async function o(e,t){let r=a();try{var s;let l=(await r(e).create([{fields:t}]))[0];return{success:!0,data:{id:l.id,createdTime:null==(s=l._rawJson)?void 0:s.createdTime,...l.fields}}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}async function n(e,t,r){let s=a();try{var l;let a=(await s(e).update([{id:t,fields:r}]))[0];return{success:!0,data:{id:a.id,createdTime:null==(l=a._rawJson)?void 0:l.createdTime,...a.fields}}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}async function d(e,t){let r=a();try{return await r(e).destroy([t]),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}},3699:(e,t,r)=>{"use strict";r.d(t,{CG:()=>s}),r(8956),r(9509);let s={STORYTELLERS:"tbl9zxLsGOd3fjWXp",MEDIA:"tbldCVl8n3JyPvamD",THEMES:"tblbfySNA6wg9lR12",QUOTES:"tblCq6v5eQl3GNkBO",GALLERIES:"tbl6YnHXjnPMC6ENx",STORIES:"tbl34r8BqNDgPI3ZN",SHIFTS:"tblArZd2LG32otN1A",MANUAL_TAGS:"tblSKRtr1wAYilVMJ",COMMENTS:"tblMtUK5zvDYL5drk",CONTACT:"tblCAr2KCgtFi0y1M",USERS:"tblMMHSiT7awfSjOR",ASSIGNMENT_TABLE:"tblZB2qXlhGhu8jSI",POST_SHIFT_REFLECTION:"tblu1gdJgiUtc8ZZN",PHOTOGRAPHER_THEMES:"tblAZnGkFw5EtXIq7",FORMS:"tblRwVbSL4vOsJkrw",EMPATHY_JOURNAL:"tblTyQF7nVTX14GpE"}},5487:(e,t,r)=>{Promise.resolve().then(r.bind(r,8852))},8852:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),l=r(2115),a=r(1322),i=r(3699),o=r(3568);function n(e){let{story:t,onSuccess:r,onError:n}=e,[d,c]=(0,l.useState)(!1),[u,m]=(0,l.useState)({}),[y,b]=(0,l.useState)({});(0,l.useEffect)(()=>{m(t||{title:"",summary:"",content:"",theme:"",storyteller:"",media:[],quotes:[],shifts:[],comments:[]}),b({})},[t]);let f=()=>{var e;let t={};return(null==(e=u.title)?void 0:e.trim())||(t.title="Title is required"),b(t),0===Object.keys(t).length},h=e=>{let{id:t,value:r}=e.target;m(e=>({...e,[t]:r})),y[t]&&b(e=>({...e,[t]:void 0}))},g=async e=>{if(e.preventDefault(),!f())return void o.Ay.error("Please fix the errors in the form.");c(!0);let s=o.Ay.loading(t?"Updating story...":"Creating story...");try{let e,l=t?"Story updated successfully!":"Story created successfully!",d=t?"Failed to update story":"Failed to create story";if((e=t?await (0,a.vL)(i.CG.STORIES,t.id,u):await (0,a.eC)(i.CG.STORIES,u)).success)o.Ay.success(l,{id:s}),r();else{let t=e.error||d;o.Ay.error(t,{id:s}),n(t)}}catch(t){let e=t instanceof Error?t.message:"An unexpected error occurred";o.Ay.error(e,{id:s}),n(e)}finally{c(!1)}},x=async()=>{if(!t||!confirm("Are you sure you want to delete this story?"))return;c(!0);let e=o.Ay.loading("Deleting story...");try{let s=await (0,a.LK)(i.CG.STORIES,t.id);if(s.success)o.Ay.success("Story deleted successfully!",{id:e}),r();else{let t=s.error||"Failed to delete story";o.Ay.error(t,{id:e}),n(t)}}catch(r){let t=r instanceof Error?r.message:"An unexpected error occurred";o.Ay.error(t,{id:e}),n(t)}finally{c(!1)}};return(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:["Title ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",id:"title",value:u.title||"",onChange:h,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 ".concat(y.title?"border-red-500":""),"aria-describedby":y.title?"title-error":void 0}),y.title&&(0,s.jsx)("p",{id:"title-error",className:"mt-1 text-sm text-red-600",children:y.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"summary",className:"block text-sm font-medium text-gray-700",children:"Summary"}),(0,s.jsx)("textarea",{id:"summary",value:u.summary||"",onChange:h,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:2})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"Content"}),(0,s.jsx)("textarea",{id:"content",value:u.content||"",onChange:h,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:6})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"theme",className:"block text-sm font-medium text-gray-700",children:"Theme"}),(0,s.jsx)("input",{type:"text",id:"theme",value:u.theme||"",onChange:h,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"storyteller",className:"block text-sm font-medium text-gray-700",children:"Storyteller"}),(0,s.jsx)("input",{type:"text",id:"storyteller",value:"string"==typeof u.storyteller||Array.isArray(u.storyteller)?u.storyteller:"",onChange:h,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50",children:d?"Saving...":t?"Update Story":"Create Story"}),t&&(0,s.jsx)("button",{type:"button",onClick:x,disabled:d,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",children:d?"Deleting...":"Delete Story"})]})]})})}var d=r(5695);function c(){let e=(0,d.useRouter)();return(0,s.jsxs)("div",{className:"container mx-auto py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Share Your Story"}),(0,s.jsx)(n,{onSuccess:()=>{e.push("/stories")},onError:e=>{}})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[846,568,441,684,358],()=>t(5487)),_N_E=e.O()}]);